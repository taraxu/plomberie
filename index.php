<!DOCTYPE html><html><head>    <meta charset="utf-8" lang="fr">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>    <title>monplombierbienaime</title>    <meta name="keywords" content="plombier, lille, aménagement, salle de bain, cuisine, dépaneur, fuite d'eau, nord, chauffage, installation, cumulus, VMC ventilation" />    <meta name="description"  content="dépanage plomberie et aménagement salle de bain et cuisine" />    <meta name="robots" content="index,follow" />    <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">    <link rel="stylesheet" href="css/font-awesome/css/font-awesome.min.css">    <link rel="icon" type="image/x-icon" href="instructions/favicon.ico"/>    <link rel="stylesheet" type="text/css" href="css/style.css">        <!--<base href="localhost:8888/projet/index.php">!--></head><body>    <header>        <div id="menu">            <div id="logo">                <ul>                    <li><img src="instructions/logo.png" alt="logo"></li>                    <li>Sur la métropole lilloise</li>                </ul>                <div id="generalinfo">                    <p>Demandez un devis gratuit</p>                    <p><a href="tel:+33668964817">Tél: 06 68 96 48 17</a></p>                    <p>Email : monplombierbienaime@gmail.com</p>                </div>            </div>            <nav>                <a href="#">Accueil</a>                <a href="#services">Nos services</a>                <a href="#chantiers">Nos chantiers</a>                <a href="#contacts">Nous contacter</a>            </nav>            <div id="fa-bars">                <i class="fa fa-bars fa-2x" aria-hidden="true"></i>                <p>menu</p>            </div>        </div>        <div id="dropMenu">            <ul>                <li><a href="#services">Nos services</a></li>                <li><a href="#chantiers">Nos chantiers</a></li>                <li><a href="#contacts">Nous contacter</a></li>            </ul>        </div>        <div id="backgroundimg">        </div>    </header>    <main  class="maincontent">        <div class="floatIcon">            <a href="#contacts"><i class="fa fa-commenting-o fa-3x" aria-hidden="true"></i>            <p>Envoyer un message</p>            </a>        </div>        <div>            <!-- Services !-->            <h2 id="services">-Nos <span>Services</span>-</h2>        	<section class="nosservices">                <div class="service">                    <img src="instructions/service1.png">                    <h3>Plomberie</h3>                    <ul>                		<li>Dépannage plomberie</li>                		<li>Aménagement salle de bain et cuisine</li>                		<li>Traitement d'eau</li>                    </ul>                </div>                <div class="service">                    <img src="instructions/service2.png">                    <h3>Chauffage</h3>                    <ul>                        <li>Installation et remplacement de chaudière</li>                        <li>Installation de chauffage central(radiateur et plancher chauffant)</li>                    </ul>                </div>                <div class="service">                    <img src="instructions/service3.png">                    <h3>Ventilation</h3>                    <ul>                        <li>Ventilation(double flux)</li>                        <li>Traitement d'air</li>                        <li>Climatisation</li>                    </ul>                </div>		        	</section>            <!-- sliders!-->            <h2 id="chantiers">- Nos <span>Chantiers</span>-</h2>            <section>                <div id='hideAera'>                    <p id="stop"><i class="fa fa-pause-circle-o fa-4x" aria-hidden="true"></i></p>                    <p id="start"><i class="fa fa-play-circle-o fa-4x" aria-hidden="true"></i></p>                </div>                <div id="slider">                    <ul class="sliderDetail">                        <li class="sliderImg"><img src="instructions/slider1.jpg" alt="slider1"></li>                        <li class="sliderImg"><img src="instructions/slider2.jpg" alt="slider2"></li>                        <li class="sliderImg"><img src="instructions/slider3.jpg" alt="slider3"></li>                    </ul>                </div>            </section>        	<!-- contact !-->            <h2 id="contacts">-Nous <span>contacter</span>-</h2>            <section id="contactform">                <form action="" method="post" enctype="multipart/form-data">                    <p>Les champs avec * sont obligatoires</p>                    <input type="text" name="firstname" placeholder="Prénom *" required>                    <input type="text" name="lastname" placeholder="Nom *" required>                    <input type="text" name="zipcode" placeholder="Code postal *" pattern="[0-9]{5}"required>                    <input type="mail" name="mail" placeholder="Email *" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" required>                    <textarea cols="80" rows="10" name="content" placeholder="Message *" required></textarea>                    <p>Souhaitez-vous nous faire parvenir des photos?</p>                    <p>Formats acceptés (JPG, PNG ou GIF | taille de chaque photo max 2Mo) :</p>                    <input type="hidden" name="MAX_FILE_SIZE" value="2000000" ><!-- 2M de chaque photo !-->                    <input type="file" name="picture[]">                    <input type="file" name="picture[]">                    <input type="file" name="picture[]">                    <input type="file" name="picture[]">                    <input id="send" type="submit" name="submit" value="Envoyer">                </form>                <?php//connexion des BDDtry{    $bdd = new PDO('mysql:host=localhost;dbname=Plomberie;charset=utf8', 'root', 'root');}catch(Exception $e){    die('Erreur : '.$e->getMessage());}    if (count($_POST) >0 ) {        //Traiter le formulaire...        if (is_array($_POST)) {            $mail = $_POST['mail'];            $result = $bdd->prepare("SELECT COUNT(firstname) as number FROM writers WHERE mail='$mail'");            $result->execute();            $donnes = $result->fetch();           // var_dump($donnes);            if($donnes['number'] == 0) { //nouveau message writer                //inserer les infos dans la table "writers" pour générer la "writer_id "                $result2 = $bdd->prepare('INSERT INTO writers (firstname, lastname, zipcode, mail) VALUES(?, ?, ?, ?)');                $donnes2 = $result2->execute(array($_POST['firstname'], $_POST['lastname'], $_POST['zipcode'], $_POST['mail']));                //Capter la "writer_id"                $result3 = $bdd->prepare("SELECT writer_id FROM writers WHERE mail='$mail'");                $result3->execute();                $donnes3 = $result3->fetch();               // var_dump($donnes3);                foreach ($donnes3 as $k => $v) {                };                $writerID = intval($v);                //inserer les infos dans la table "messages" avec la "writer_id"                $result4 = $bdd->prepare('INSERT INTO messages (content, writer_id) VALUES(?, ?)');                $donnes4 = $result4->execute(array($_POST['content'], $writerID));            }else{                $zipcode = $_POST['zipcode'];                $result5 = $bdd->prepare("SELECT COUNT(zipcode) AS zipcodeNumber FROM writers WHERE mail='$mail' AND (zipcode='$zipcode' OR zipcode2='$zipcode') " );                $result5 ->execute();                $donnes5 = $result5->fetch();                var_dump($donnes5);                if ($donnes5['zipcodeNumber'] == 0) {                    //if zipcode2 is null??????????                    if ($donnes5['zipcode2'] == NULL) {                        $result6 = $bdd->prepare("UPDATE writers SET zipcode2 = '$zipcode' WHERE mail = '$mail'");                        $donnes6 = $result6->execute(array($_POST['zipcode']));                        $result33 = $bdd->prepare("SELECT writer_id FROM writers WHERE mail='$mail'");                        $result33->execute();                        $donnes33 = $result33->fetch();                        foreach ($donnes33 as $k3 => $v3) {                        };                        $writerID3 = intval($v3);                        $content = $_POST['content'];                        $result7 = $bdd->prepare("UPDATE messages SET content = '$content' WHERE writer_id = '$writerID3'");                        $donnes7 = $result7->execute(array($_POST['content']));                    }else {                        //qu'écraser zipcode2, insert into content                        $result100 = $bdd->prepare("UPDATE writers SET zipcode2 = '$zipcode' WHERE mail = '$mail'");                        $donnes100 = $result100->execute(array($_POST['zipcode']));                        $result200 = $bdd->prepare("SELECT writer_id FROM writers WHERE mail='$mail'");                        $result200->execute();                        $donnes200 = $result200->fetch();                        foreach ($donnes200 as $k200 => $v200) {                        };                        $writerID200 = intval($v200);                        $result300 = $bdd->prepare("INSERT INTO messages (content, writer_id) VALUES(?, ?)");                        $donnes300 = $result300->execute(array($_POST['content'], $writerID200));                    }                }else {                    $result34 = $bdd->prepare("SELECT writer_id FROM writers WHERE mail='$mail'");                    $result34->execute();                    $donnes34 = $result34->fetch();                    // var_dump($donnes3);                    foreach ($donnes34 as $k34 => $v34) {                    };                    $writerID34 = intval($v34);                    $result8 = $bdd->prepare("INSERT INTO messages (content, writer_id) VALUES(?, ?)");                    $donnes8 = $result8->execute(array($_POST['content'], $writerID34));                }            };       };    }//Traitement du formulaire, partie multiple upload file    if (isset($_FILES['picture'])) {        $files = $_FILES['picture'];        foreach ($files['name'] as $i => $fileName) {            $fileError = $files['error'][$i];            $fileTmpName = $files['tmp_name'][$i];            $uploadExtension = strtolower(substr(strrchr($fileName,"."),1));            $allowExtention = ['jpg', 'jpeg', 'png', 'gif'];            $uniqueTmpName = md5(uniqid(rand(), true)) . '.'.$uploadExtension;            if ($fileError !== 0){                if ($fileError === UPLOAD_ERR_INI_SIZE) {                    $msg =  "La totalité des photos envoyée est trop volumineuse";                }elseif($fileError === UPLOAD_ERR_FORM_SIZE) {                    $msg = $fileName . " est trop volumineux";                }elseif($fileError === UPLOAD_ERR_PARTIAL) {                    $msg = "Envoie de la photo " . $fileName . " n'est pas réussie";                }elseif($fileError === UPLOAD_ERR_EXTENSION) {                    $msg = "Le format du fichier n'est pas adapté";                }elseif($fileError === UPLOAD_ERR_NO_FILE) {                    $msg = "";                }            }else{                if(in_array($uploadExtension, $allowExtention)){                   $uploadFile = move_uploaded_file($fileTmpName,'upload/'.$uniqueTmpName.$uploadExtension);                   $msg = $fileName ." est bien envoyé";                }else{                    $msg = "Le format de la photo ".$fileName . " n'est pas autorisé";                }            }            echo $msg."<br>";        }    };    if(isset($_POST['submit'])){        if(!empty($uploadFile)){            $mailMsg = 'Vous avez reçu un nouveau message de: ' . "\n"                . 'Prénom: ' . $_POST['lastname'] . "\n"                . 'Nom: ' . $_POST['firstname'] . "\n"                . 'Email: ' . $_POST['mail'] . "\n"                . 'Photo:' . "oui" . "\n"                . 'Message: ' . $_POST['content'] ;                mail('yangxumailbox@gmail.com', 'Message du site Mon plombier bien aime', $mailMsg);            }else{            $mailMsg = 'Vous avez reçu un nouveau message de: ' . "\n"                . 'Prénom: ' . $_POST['lastname'] . "\n"                . 'Nom: ' . $_POST['firstname'] . "\n"                . 'Email: ' . $_POST['mail'] . "\n"                . 'Photo:' . "non" . "\n"                . 'Message: ' . $_POST['content'] ;            mail('yangxumailbox@gmail.com', 'Message du site Mon plombier bien aime', $mailMsg);            }    }?>                <div id="googlemap">                    <h4><span>Mon plombier bien aimé</span></h4>                    <h4>Sur la métropole lilloise(Lille, Lomme, Lambersart)</h4><br><br>                    <h4><span>Devis gratuit</span></h4>                    <h4><a href="tel:+33668964817"><i class="fa fa-mobile" aria-hidden="true"></i><button>06 68 96 48 17</button></a>                    </h4>                    <h4><i class="far fa-envelope"></i> monplombierbienaime@gmail.com</h4>                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d80985.23059984011!2d2.977120874675211!3d50.631046507693576!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47c2d579b3256e11%3A0x40af13e81646360!2sLille!5e0!3m2!1sfr!2sfr!4v1517229394277"  allowfullscreen></iframe>                </div>            </section>        </div>    </main>    <div id="house"></div>    <footer>        <p><img src="instructions/logo.png" alt="logo">Par<a href="yang.php">yangxu.fr</a></p>    </footer>    <script type="text/javascript" src="sliders.js"></script>    <script type="text/javascript" src="jq.js"></script></body></html>